<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">























  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link rel="stylesheet" href="//fonts.lug.ustc.edu.cn/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext">
  






<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.0.1',
    sidebar: {"position":"right","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="ä»Šå¤©ä¸å¼€å¿ƒ">
<meta property="og:type" content="website">
<meta property="og:title" content="åæ ¸|Core Dump">
<meta property="og:url" content="https://blog.spider.im/page/2/index.html">
<meta property="og:site_name" content="åæ ¸|Core Dump">
<meta property="og:description" content="ä»Šå¤©ä¸å¼€å¿ƒ">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="åæ ¸|Core Dump">
<meta name="twitter:description" content="ä»Šå¤©ä¸å¼€å¿ƒ">






  <link rel="canonical" href="https://blog.spider.im/page/2/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>åæ ¸|Core Dump</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-right 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">åæ ¸|Core Dump</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">ç¬”è®° éšæƒ³ åæ§½</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>é¦–é¡µ</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>å…³äº</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>æ ‡ç­¾</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>åˆ†ç±»</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>å½’æ¡£</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.spider.im/post/admission-controller/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lovejoy">
      <meta itemprop="description" content="ä»Šå¤©ä¸å¼€å¿ƒ">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åæ ¸|Core Dump">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/post/admission-controller/" class="post-title-link" itemprop="url">å¦‚ä½•å®ç°ç³»åˆ—äºŒï¼šå®ç°ä¸€ä¸ªè‡ªå·±çš„admission controller</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2019-03-06 15:43:58" itemprop="dateCreated datePublished" datetime="2019-03-06T15:43:58+08:00">2019-03-06</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-03-11 21:50:15" itemprop="dateModified" datetime="2019-03-11T21:50:15+08:00">2019-03-11</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>å‡†å…¥æ§åˆ¶å™¨ï¼ˆAdmission Controllerï¼‰ä½äº API Server ä¸­ï¼Œåœ¨å¯¹è±¡è¢«æŒä¹…åŒ–ä¹‹å‰ï¼Œå‡†å…¥æ§åˆ¶å™¨æ‹¦æˆªå¯¹ API Server çš„è¯·æ±‚ï¼Œä¸€èˆ¬ç”¨æ¥åšèº«ä»½éªŒè¯å’Œæˆæƒï¼Œä¸è¿‡ä»è®¾è®¡ä¸Šç”±äºä½äºapiserveræŠŠæ•°æ®å†™å…¥etcdä¹‹å‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åŠ å…¥ä¸€äº›è‡ªå·±çš„é€»è¾‘ï¼Œæˆ–è€…æ”¹å†™apiseveråˆ°etcdä¸­çš„æ•°æ®ã€‚çº¿ä¸Šæˆ‘ä»¬é•¿å¼€çš„admissionä¸»è¦æ˜¯NamespaceLifecycle,ResourceQuota,namespacelifecycleæ˜¯ä¿è¯åˆ namespaceçš„æ—¶å€™ä¸ä¼šå†æœ‰podåˆ›å»º;resourcequotaä¸»è¦æ˜¯æ€»æ§namespaceä¸‹çš„requestå’Œlimitï¼Œä¸€èˆ¬æˆ‘ä»¬ç”¨æ¥åšæ€»ä½“èµ„æºé™åˆ¶,å…¶ä»–admissionçš„å…·ä½“ä»‹ç»å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£<br><a href="https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/" target="_blank" rel="noopener">https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/</a></p>
<p>admissionçš„å„ä¸ªç­–ç•¥çš„å®ç°å¾ˆå®¹å™¨æ‰¾åˆ°ï¼Œä»£ç éƒ½åœ¨ä¸­src/k8s.io/kubernetes/plugin/pkg/admission ä¸­,<br>ä¸è¿‡admissionæœ¬èº«çš„ä»£ç å®ç°å°±æœ‰ç‚¹éš¾æ‰¾äº†ï¼Œè—åœ¨äº†src/k8s.io/kubernetes/staging/src/k8s.io/apiserver/pkg/admission/initializer/initializer.go ä¸­ï¼Œ<br>ä¸€èˆ¬ideè¿˜ä¸ä¸€å®šèƒ½æ‰¾åˆ°ã€‚<br>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/post/admission-controller/#more" rel="contents">
                é˜…è¯»å…¨æ–‡ &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </p></div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.spider.im/post/control-disk-size-in-docker/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lovejoy">
      <meta itemprop="description" content="ä»Šå¤©ä¸å¼€å¿ƒ">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åæ ¸|Core Dump">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/post/control-disk-size-in-docker/" class="post-title-link" itemprop="url">å¦‚ä½•å®ç°ç³»åˆ—ä¸€ï¼šå¦‚ä½•æ§åˆ¶k8s podä¸­ç£ç›˜ç©ºé—´çš„å¤§å°</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2019-03-06 14:55:03" itemprop="dateCreated datePublished" datetime="2019-03-06T14:55:03+08:00">2019-03-06</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-03-11 21:50:15" itemprop="dateModified" datetime="2019-03-11T21:50:15+08:00">2019-03-11</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>è¿™2å¹´åŸºäºk8såšäº†å¤§é‡çš„å·¥ä½œï¼Œå…¶ä¸­å¾ˆå¤šç›¸ä¿¡ä¸šç•Œçš„åŒä»ä¹Ÿä¼šç¢°åˆ°ï¼Œæ‰“ç®—å¼€ä¸ªç³»åˆ—æ¥ä»‹ç»ä¸‹ï¼Œç›¸å…³çš„ä¸œè¥¿å¦‚ä½•å®ç°ï¼Œä¹Ÿä½œä¸ºè¿™æ–¹é¢çš„ä¸€äº›æ€»ç»“</p>
<p>k8sé›†ç¾¤ç®¡ç†å¿…ç„¶ä¼šé‡åˆ°çš„ä¸€ä¸ªé—®é¢˜ï¼Œç£ç›˜ç©ºé—´æ§åˆ¶é—®é¢˜, ä¸šåŠ¡æ–¹çš„ä»£ç è·‘åœ¨å®¹å™¨ä¸­ï¼Œå¿…ç„¶ä¼šç”Ÿæˆæ—¥å¿—å’Œä¸´æ—¶æ–‡ä»¶ï¼Œä¹Ÿå¿…ç„¶ä¼šé‡åˆ°ç£ç›˜ç©ºé—´æ§åˆ¶çš„é—®é¢˜ï¼Œä¸ç„¶ä¸šåŠ¡æ–¹å°±ç›´æ¥æŠŠç£ç›˜ç”¨æ»¡äº†ã€‚<br>å¦‚æœgoogleæœç´¢ä¸‹çš„è¯åŸºæœ¬çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼šä¿®æ”¹dockerçš„å‚æ•° ï¼Œæ·»åŠ  â€“storage-opt dm.basesize= å‚æ•°è®¾ç½®ä¸ºéœ€è¦çš„å€¼ ğŸ˜€</p>
<p>ç„¶è€Œè¿™ä¸æ˜¯ä¸€ä¸ªå¯ä»¥éšä¸åŒçš„ä¸šåŠ¡å’Œå®¹å™¨å˜åŒ–çš„å€¼ï¼Œå³docker daemonå¯åŠ¨åï¼Œåˆ›å»ºçš„å®¹å™¨çš„æ ¹åˆ†åŒºçš„å¤§å°éƒ½æ˜¯è¿™ä¸ªå€¼ã€‚å¹¶ä¸æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯æ ¹æ®ä¸åŒçš„ä¸šåŠ¡è®¾ç½®ä¸åŒçš„å¤§å°ï¼Œå³æˆ‘ä»¬æä¾›ç»™ç”¨æˆ·çš„å®¹å™¨è§„æ ¼é™¤äº†CPUå’ŒMEMä¹‹å¤–è¿˜æœ‰DISKçš„å¤§å°ï¼Œå½“ç„¶dm.basesizeè¿™ä¸ªå€¼æ¨èä¿®æ”¹(è¿™ä¸ªå€¼ä¹Ÿé™åˆ¶äº†é•œåƒçš„å¤§å°ï¼‰ï¼Œé»˜è®¤å€¼æ˜¯10Gï¼Œå»ºè®®ä¿®æ”¹æˆ20Gï¼Œè™½ç„¶ç›®å‰å¤§éƒ¨åˆ†ä¸šåŠ¡é•œåƒéƒ½æ˜¯åœ¨5Gä¹‹å†…ï¼Œä½†æ˜¯éšç€æœºå™¨å­¦ä¹ çš„å…´èµ·ï¼Œç›¸å…³çš„é•œåƒæ™®éåå¤§,æœ‰è¶…è¿‡10Gç‚¹ç°è±¡</p>
<p>å›åˆ°æ­£é¢˜ï¼Œå¦‚ä½•é™åˆ¶ç£ç›˜ç©ºé—´ï¼š<br>é¦–å…ˆæˆ‘ä»¬çš„å®¹å™¨ç”¨çš„ç£ç›˜éƒ½æ˜¯æœ¬åœ°ç›˜ï¼Œé‚£ä¹ˆå°±éœ€è¦ä»æœ¬åœ°ç£ç›˜çš„æ–¹æ¡ˆæ¥è€ƒè™‘é™åˆ¶ã€‚å³éœ€è¦æœ‰åŠæ³•ä»æœ¬åœ°ç£ç›˜åˆ‡åˆ†ä¸åŒçš„å¤§å°ï¼šè¿™é‡Œæ¨è2ä¸ªæ–¹æ³•ï¼šLVM(lvmç›¸å…³å‘½ä»¤)ä»¥åŠDeviceMapper(dmsetupç›¸å…³å‘½ä»¤)ã€‚è¿™2ä¸ªæ–¹æ¡ˆåˆ†åˆ«åœ¨ä¸åŒçš„åœ°æ–¹å®è·µè¿‡ï¼Œå„æœ‰åˆ©å¼Šã€‚å³æˆ‘ä»¬é€šè¿‡ä¸€äº›ç³»ç»Ÿå‘½ä»¤ï¼Œåœ¨nodeä¸Šçš„ç‰©ç†ç£ç›˜ä¸Šåˆ†é…å‡ºç›¸åº”å¤§å°çš„ç©ºé—´ï¼Œç„¶åé€šè¿‡flexvolumeæŒ‚åˆ°å®¹å™¨ä¸­ï¼Œå®ç°æ§åˆ¶å®¹å™¨ç£ç›˜å¤§å°çš„ç›®çš„(æ³¨æ„è¿™é‡Œæ ¹åˆ†åŒºè¿˜æ˜¯basesizeçš„å¤§å°)ã€‚FlexVolumeçš„åŠŸèƒ½è¯·å‚è€ƒ<a href="/post/flex-volume-plugin/">å‰æ–‡</a><br>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/post/control-disk-size-in-docker/#more" rel="contents">
                é˜…è¯»å…¨æ–‡ &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </p></div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.spider.im/post/gpu-share-in-k8s/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lovejoy">
      <meta itemprop="description" content="ä»Šå¤©ä¸å¼€å¿ƒ">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åæ ¸|Core Dump">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/post/gpu-share-in-k8s/" class="post-title-link" itemprop="url">k8sä¸­çš„GPUå…±äº«åŠŸèƒ½å®ç°åˆ†æ</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2019-02-21 17:52:04" itemprop="dateCreated datePublished" datetime="2019-02-21T17:52:04+08:00">2019-02-21</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-03-11 21:50:15" itemprop="dateModified" datetime="2019-03-11T21:50:15+08:00">2019-03-11</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>GPUåœ¨å®¹å™¨é—´å…±äº«è¿™ä¸ªåŠŸèƒ½å…¶å®éƒ½æœ‰éœ€è¦ï¼Œä½†æ˜¯å®˜æ–¹éƒ½æ²¡æœ‰ï¼Œä¹‹å‰åœ¨å…¬å¸å†…å®ç°çš„æ”¹åŠ¨ä¹Ÿå¤ªè¿‡äºin-treeï¼Œæ— æ³•opensourceï¼Œä»Šå¤©çœ‹åˆ°é˜¿é‡Œäº‘å¼€æºäº†ä¸ªGPUå…±äº«çš„æ–¹æ¡ˆï¼Œé‚£ä¹ˆé¡ºé“å€Ÿåˆ†æä¸‹é˜¿é‡Œçš„æ–¹æ¡ˆæ¥æ€»ç»“ä¸‹è¿™æ–¹é¢çš„äº‹æƒ…ã€‚</p>
<p>é˜¿é‡Œäº‘çš„ä»£ç åœ¨<br><a href="https://github.com/AliyunContainerService/gpushare-scheduler-extender" target="_blank" rel="noopener">https://github.com/AliyunContainerService/gpushare-scheduler-extender</a><br><a href="https://github.com/AliyunContainerService/gpushare-device-plugin" target="_blank" rel="noopener">https://github.com/AliyunContainerService/gpushare-device-plugin</a><br>é˜¿é‡Œäº‘å®ç°äº†ä¸€ä¸ªgpushareçš„device-pluginï¼Œç„¶åå®ç°äº†ç›¸å…³çš„è°ƒåº¦é€»è¾‘</p>
<p>ç”±äºå…·ä½“çš„å…±äº«é€»è¾‘åœ¨nodeä¸Šï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆçœ‹ä¸‹device-pluginçš„å®ç°ã€‚<br>ä¹‹å‰çœ‹è¿‡nvidiaçš„å®˜æ–¹device-pluginå®ç°ï¼Œæœ¬è´¨å¾ˆç®€å•ï¼Œéœ€è¦å®ç°2ä¸ªæ¥å£ 1.listandwatchç”¨äºè·å¾—æœºå™¨ä¸Šçš„deviceåˆ—è¡¨ï¼Œ2. allocateæ¥å£ç”¨äºkubeletåˆ†é…è®¾å¤‡æ—¶ï¼Œè¿™ä¸ªè®¾å¤‡è¦åšçš„ä¸€äº›äº‹æƒ… è¿™ä¸ªè®¾è®¡å…¶å®ä¸æ˜¯é‚£ä¹ˆå¥½ï¼Œè¿™ä¸ªä¹‹å‰çš„<a href="/post/nvidia-kubernetes/">nvidia k8så’Œå®˜æ–¹çš„åŒºåˆ«ä¸­</a> æœ‰æåˆ°,é™åˆ¶äº†devicepluginå¯¹è®¾å¤‡çš„è°ƒåº¦æ§åˆ¶èƒ½åŠ› (device-pluginç›¸å…³çš„å®ç°åé¢ä¹Ÿçœ‹ä¸‹è¡¥ç¯‡æ–‡ç« )</p>
<p>å…¥å£ä»£ç ï¼Œå’Œnvidiaå®˜æ–¹æœ¬è´¨æ²¡ä»€ä¹ˆåŒºåˆ«ï¼ŒåŠ è½½äº†nvmlçš„åº“(cgoçš„)ç”¨æˆ·è·å–æœºå™¨ä¸Šçš„gpuçš„ä¿¡æ¯<br>åˆ›å»ºäº†ä¸ªfsNotifyå»å®ç°devicepluginè¦æ±‚çš„ç›¸å…³é€»è¾‘<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ngm *sharedGPUManager)</span> <span class="title">Run</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	log.V(<span class="number">1</span>).Infoln(<span class="string">"Loading NVML"</span>)</span><br><span class="line">	<span class="keyword">if</span> err := nvml.Init(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.V(<span class="number">1</span>).Infof(<span class="string">"Failed to initialize NVML: %s."</span>, err)</span><br><span class="line">		log.V(<span class="number">1</span>).Infof(<span class="string">"If this is a GPU node, did you set the docker default runtime to `nvidia`?"</span>)</span><br><span class="line">		<span class="keyword">select</span> &#123;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; log.V(<span class="number">1</span>).Infoln(<span class="string">"Shutdown of NVML returned:"</span>, nvml.Shutdown()) &#125;()</span><br><span class="line">	log.V(<span class="number">1</span>).Infoln(<span class="string">"Fetching devices."</span>)</span><br><span class="line">	<span class="keyword">if</span> getDeviceCount() == <span class="keyword">uint</span>(<span class="number">0</span>) &#123;</span><br><span class="line">		log.V(<span class="number">1</span>).Infoln(<span class="string">"No devices found. Waiting indefinitely."</span>)</span><br><span class="line">		<span class="keyword">select</span> &#123;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	log.V(<span class="number">1</span>).Infoln(<span class="string">"Starting FS watcher."</span>)</span><br><span class="line">	watcher, err := newFSWatcher(pluginapi.DevicePluginPath)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.V(<span class="number">1</span>).Infoln(<span class="string">"Failed to created FS watcher."</span>)</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> watcher.Close()</span><br><span class="line">	log.V(<span class="number">1</span>).Infoln(<span class="string">"Starting OS watcher."</span>)</span><br><span class="line">	sigs := newOSWatcher(syscall.SIGHUP, syscall.SIGINT, syscall.SIGTERM, syscall.SIGQUIT)</span><br><span class="line">	restart := <span class="literal">true</span></span><br><span class="line">	<span class="keyword">var</span> devicePlugin *NvidiaDevicePlugin</span><br><span class="line">L:</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> restart &#123;</span><br><span class="line">			<span class="keyword">if</span> devicePlugin != <span class="literal">nil</span> &#123;</span><br><span class="line">				devicePlugin.Stop()</span><br><span class="line">			&#125;</span><br><span class="line">			devicePlugin = NewNvidiaDevicePlugin(ngm.enableMPS, ngm.healthCheck)</span><br><span class="line">			<span class="keyword">if</span> err := devicePlugin.Serve(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">				log.Warningf(<span class="string">"Failed to start device plugin due to %v"</span>, err)</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				restart = <span class="literal">false</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">select</span> &#123;</span><br><span class="line">		<span class="keyword">case</span> event := &lt;-watcher.Events:</span><br><span class="line">			<span class="keyword">if</span> event.Name == pluginapi.KubeletSocket &amp;&amp; event.Op&amp;fsnotify.Create == fsnotify.Create &#123;</span><br><span class="line">				log.V(<span class="number">1</span>).Infof(<span class="string">"inotify: %s created, restarting."</span>, pluginapi.KubeletSocket)</span><br><span class="line">				restart = <span class="literal">true</span></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">case</span> err := &lt;-watcher.Errors:</span><br><span class="line">			log.Warningf(<span class="string">"inotify: %s"</span>, err)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">case</span> s := &lt;-sigs:</span><br><span class="line">			<span class="keyword">switch</span> s &#123;</span><br><span class="line">			<span class="keyword">case</span> syscall.SIGHUP:</span><br><span class="line">				log.V(<span class="number">1</span>).Infoln(<span class="string">"Received SIGHUP, restarting."</span>)</span><br><span class="line">				restart = <span class="literal">true</span></span><br><span class="line">			<span class="keyword">case</span> syscall.SIGQUIT:</span><br><span class="line">				t := time.Now()</span><br><span class="line">				timestamp := fmt.Sprint(t.Format(<span class="string">"20060102150405"</span>))</span><br><span class="line">				log.Infoln(<span class="string">"generate core dump"</span>)</span><br><span class="line">				coredump(<span class="string">"/etc/kubernetes/go_"</span> + timestamp + <span class="string">".txt"</span>)</span><br><span class="line">			<span class="keyword">default</span>:</span><br><span class="line">				log.V(<span class="number">1</span>).Infof(<span class="string">"Received signal \"%v\", shutting down."</span>, s)</span><br><span class="line">				devicePlugin.Stop()</span><br><span class="line">				<span class="keyword">break</span> L</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/post/gpu-share-in-k8s/#more" rel="contents">
                é˜…è¯»å…¨æ–‡ &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.spider.im/post/nvidia-kubernetes/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lovejoy">
      <meta itemprop="description" content="ä»Šå¤©ä¸å¼€å¿ƒ">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åæ ¸|Core Dump">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/post/nvidia-kubernetes/" class="post-title-link" itemprop="url">nvidia kubernetes å’Œå®˜æ–¹k8sçš„ä¸åŒ</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2019-02-19 10:43:33" itemprop="dateCreated datePublished" datetime="2019-02-19T10:43:33+08:00">2019-02-19</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-03-11 21:50:15" itemprop="dateModified" datetime="2019-03-11T21:50:15+08:00">2019-03-11</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>nvidia kubernetesæ˜¯ä»å®˜æ–¹ä¸€ä¸ªcommit æ‹‰å‡ºæ¥æ”¹çš„ï¼Œæ‰€æœ‰çš„æ”¹åŠ¨å¯ä»¥é€šè¿‡ä¸‹é¢çš„é“¾æ¥çœ‹åˆ°<br><a href="https://github.com/NVIDIA/kubernetes/compare/dd5e1a2978fd0b97d9b78e1564398aeea7e7fe92...NVIDIA:master" target="_blank" rel="noopener">https://github.com/NVIDIA/kubernetes/compare/dd5e1a2978fd0b97d9b78e1564398aeea7e7fe92...NVIDIA:master</a></p>
<p>ä¸»è¦çš„å‡ ä¸ªæ”¹åŠ¨</p>
<ol>
<li><p>æ·»åŠ äº†æ‰©å±•èµ„æºçš„å®šä¹‰ï¼Œå¯¹containerä¸Šçš„ExtendedResourceRequestï¼Œå¯¹podSpecä¸Šçš„extendedResourcesï¼Œselectorä¸Šçš„extendedResourceAffinityï¼Œnodeä¸Šçš„ExtendedResources<br><a href="https://github.com/NVIDIA/kubernetes/commit/355aff2ffc31d6403c78b68d94fa263b0de35188" target="_blank" rel="noopener">https://github.com/NVIDIA/kubernetes/commit/355aff2ffc31d6403c78b68d94fa263b0de35188</a> </p>
</li>
<li><p>é‡å†™äº†ä¸ªDevice Plugin APIï¼Œå»é™¤äº†åŸæ¥çš„registeræµç¨‹ï¼ŒåŠ äº†adminPod initContaineræ¥å£ï¼Œå®ç°äº†å¯¹nodeä¸Šæ·»åŠ èµ„æºçš„æ¥å£å®šä¹‰ </p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">struct</span> Device &#123;</span><br><span class="line">    ID: <span class="string">"GPU-fef8089b-4820-abfc-e83e-94318197576e"</span>,</span><br><span class="line">    State: <span class="string">"Healthy"</span>,</span><br><span class="line">    Attributes: &#123;</span><br><span class="line">       <span class="string">"memory"</span>: <span class="string">"8000"</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>çœ‹æ„æ€æ˜¯æ’ä»¶æ³¨å†Œåˆ°æŸä¸€ä¸ªç›®å½•ä¸‹å°±è‡ªåŠ¨å‘ç°äº†ï¼Œç„¶åå‡å°‘äº†æ³¨å†Œçš„æµç¨‹ï¼Œæœ‰ç‚¹åƒflexvolumeæ’ä»¶çš„æ„Ÿè§‰ï¼Œæ€»ä½“çš„æ”¹åŠ¨æ„Ÿè§‰ä¸é”™ï¼ŒåŸæ¥çš„æµç¨‹éœ€è¦çœ‹ä¸‹ï¼Œæˆ‘è®°å¾—åŸæ¥çš„æµç¨‹åˆ†é…å¡çš„é€»è¾‘æ˜¯kubeleté‡Œé¢å®ç°çš„ï¼Œæ„Ÿè§‰ä¸å¤ªå¥½ï¼Œè¿™é‡Œè™½ç„¶å¥½åƒä¹Ÿæ²¡æ”¹ï¼Œä½†æ˜¯åŠ å…¥äº†æ’ä»¶å¯ä»¥ä¿®æ”¹podSpecå’ŒcontainerSpecçš„é€»è¾‘<br><a href="https://github.com/NVIDIA/kubernetes/commit/23d735f02d39fd1c1464e67a355b64642cecfec6?diff=split" target="_blank" rel="noopener">https://github.com/NVIDIA/kubernetes/commit/23d735f02d39fd1c1464e67a355b64642cecfec6?diff=split</a></p>
</li>
<li><p>åŠ äº†ä¸ªdocker hookçš„åŠŸèƒ½ï¼Œçœ‹ä»£ç çš„æ„æ€æ˜¯åœ¨/usr/share/containers/docker/hooks.d/ç›®å½•ä¸‹å¯ä»¥å†™ä¸ªjsonï¼Œjsoné‡Œé¢å¯ä»¥å¡« </p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> dockerHook <span class="keyword">struct</span> &#123;</span><br><span class="line">	Runtime     <span class="keyword">string</span>            <span class="string">`json:"runtime"`</span></span><br><span class="line">	Annotations <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span> <span class="string">`json:"annotations"`</span></span><br><span class="line">	Images      []<span class="keyword">string</span>          <span class="string">`json:"images"`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ™åœ¨dockerå®¹å™¨è¿è¡Œçš„æ—¶å€™å¯ä»¥åˆ¤æ–­å®¹å™¨ä¸Šæœ‰æ²¡æœ‰annotationæˆ–è€…imageæ˜¯ç¬¦åˆhookä¸­æ‰€å†™çš„ï¼Œå¦‚æœæ˜¯åˆ™å¯åŠ¨å®¹å™¨çš„æ—¶å€™ç”¨jsonä¸­æ‰€å†™çš„runtimeæ¥å¯åŠ¨ï¼Œå¦å¤–åŠ äº†ä¸ªé»˜è®¤ä¼šçœ‹çš„annotation annotation.io.kubernetes.container.runtime</p>
</li>
<li><p>è°ƒåº¦å™¨ä¸Šå®ç°äº†å¯¹äºextendResourceçš„è°ƒåº¦åŠŸèƒ½<br><a href="https://github.com/NVIDIA/kubernetes/commit/7e06c18139e44d45bd2c0c2f702dc31716f34fe2" target="_blank" rel="noopener">https://github.com/NVIDIA/kubernetes/commit/7e06c18139e44d45bd2c0c2f702dc31716f34fe2</a><br><a href="https://github.com/NVIDIA/kubernetes/commit/3cebd40083d69e0f65a5040fe4537e74f5a4e529" target="_blank" rel="noopener">https://github.com/NVIDIA/kubernetes/commit/3cebd40083d69e0f65a5040fe4537e74f5a4e529</a><br>æ„Ÿè§‰ä¸æ˜¯ç‰¹åˆ«ä¼˜é›…ï¼Œæœ€å¥½è¿˜æ˜¯æŠŠè¿™ä¸ªèµ„æºç®—åœ¨æ™®é€šèµ„æºè°ƒåº¦é‡Œé¢æ¯”è¾ƒå¥½ï¼Œç°åœ¨å®ç°æ˜¯æ¯ä¸ªå‡½æ•°éƒ½å¤šåŠ äº†å…¥å‚</p>
</li>
<li><p>å›°äº†æ²¡ç»†çœ‹ <a href="https://github.com/NVIDIA/kubernetes/commit/df14bc461de5f639d6fd0d1eb6b7450b5a2a816b" target="_blank" rel="noopener">https://github.com/NVIDIA/kubernetes/commit/df14bc461de5f639d6fd0d1eb6b7450b5a2a816b</a> æ„Ÿè§‰æ˜¯é‡æ„äº†ä¸‹</p>
</li>
</ol>
<p><a href="https://docs.google.com/document/d/1ZgKH_K4SEfdiE_OfxQ836s4yQWxZfSjS288Tq9YIWCA/edit#heading=h.56cb5eq5qgcy" target="_blank" rel="noopener">https://docs.google.com/document/d/1ZgKH_K4SEfdiE_OfxQ836s4yQWxZfSjS288Tq9YIWCA/edit#heading=h.56cb5eq5qgcy</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.spider.im/post/flex-volume-plugin/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lovejoy">
      <meta itemprop="description" content="ä»Šå¤©ä¸å¼€å¿ƒ">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åæ ¸|Core Dump">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/post/flex-volume-plugin/" class="post-title-link" itemprop="url">k8sçš„flexvolume-pluginä»‹ç»</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2019-02-02 11:29:26" itemprop="dateCreated datePublished" datetime="2019-02-02T11:29:26+08:00">2019-02-02</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-03-11 21:50:15" itemprop="dateModified" datetime="2019-03-11T21:50:15+08:00">2019-03-11</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>k8sçš„å·ç®¡ç†ç›®å‰éƒ½æ˜¯in-treeçš„ï¼Œä¹Ÿå°±æ˜¯å†™åœ¨k8sä»£ç ä¸­ï¼Œå®é™…çœ‹äº†ä¸‹å¯¹å›½å†…ç”¨æˆ·å”¯ä¸€æœ‰ä»·å€¼çš„å°±cephç›¸å…³çš„cephfså’Œrbdä»¥åŠglusterfsï¼Œå…¶ä»–åŸºæœ¬éƒ½ä¸æ˜¯å›½å†…ç”¨æˆ·åœ¨ç”¨çš„ã€‚<br>é™¤æ­¤ä¹‹å¤–æˆ‘ä»¬å¯ä»¥æ‰©å±•çš„å°±flexvolomepluginæˆ–è€…æ˜¯csiï¼Œcsiéœ€è¦é«˜ç‰ˆæœ¬çš„k8sä»¥åŠæœ‰ç‚¹éº»çƒ¦ï¼Œè¿™é‡Œå°±ä¸å…³æ³¨äº†ã€‚è¿˜æ˜¯ä¸»è¦å…³æ³¨flexvolumeplugin</p>
<p>flexvolumeæœ‰å¤šä¸ªç”¨å¤„ï¼š</p>
<ol>
<li>ç”¨äºåŒºåˆ†æœ¬åœ°çš„ç£ç›˜ï¼Œåˆ†å‡ºç‰¹å®šçš„å¤§å°ï¼ŒæŒ‚è½½åˆ°å®¹å™¨ä¸­ï¼Œç”¨äºåŠ¨æ€æ§åˆ¶ç”¨æˆ·å¯ç”¨çš„ç©ºé—´ï¼Œè€Œä¸ä¾èµ–äºdockerçš„é…ç½® </li>
<li>åœ¨æœ‰clientçš„æƒ…å†µä¸‹ï¼ŒæŒ‚è½½è¿œç«¯çš„(åˆ†å¸ƒå¼)æ–‡ä»¶ç³»ç»Ÿ</li>
</ol>
<p>æˆ‘è¿™é‡Œçš„ç”¨é€”ä¸»è¦æ˜¯ç”¨äºæŒ‚è½½åˆ†å¸ƒå¼å­˜å‚¨ï¼Œåœ¨å®ç°æ’ä»¶çš„è¿‡ç¨‹ä¸­ï¼Œé¡ºé“çœ‹ä¸‹flexvolumeçš„ç›¸å…³ä»£ç <br>é¦–å…ˆéœ€è¦äº†è§£çš„æ˜¯ï¼šæˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºæ”¾åœ¨/usr/libexec/kubernetes/kubelet-plugins/volume/exec/&lt;vendor~driver&gt;/<driver> è¿™æ ·çš„ç›®å½•, å®ç°ä»¥ä¸‹æ¥å£<br> initï¼škubelet/kube-controller-manager åˆå§‹åŒ–å­˜å‚¨æ’ä»¶æ—¶è°ƒç”¨ï¼Œæ’ä»¶éœ€è¦è¿”å›æ˜¯å¦éœ€è¦è¦ attach å’Œ detach æ“ä½œ<br> attachï¼šå°†å­˜å‚¨å·æŒ‚è½½åˆ° Node ä¸Š<br> detachï¼šå°†å­˜å‚¨å·ä» Node ä¸Šå¸è½½<br> waitforattachï¼š ç­‰å¾… attach æ“ä½œæˆåŠŸï¼ˆè¶…æ—¶æ—¶é—´ä¸º 10 åˆ†é’Ÿï¼‰<br> isattachedï¼šæ£€æŸ¥å­˜å‚¨å·æ˜¯å¦å·²ç»æŒ‚è½½<br> mountdeviceï¼šå°†è®¾å¤‡æŒ‚è½½åˆ°æŒ‡å®šç›®å½•ä¸­ä»¥ä¾¿åç»­ bind mount ä½¿ç”¨<br> unmountdeviceï¼šå°†è®¾å¤‡å–æ¶ˆæŒ‚è½½<br> mountï¼šå°†å­˜å‚¨å·æŒ‚è½½åˆ°æŒ‡å®šç›®å½•ä¸­<br> umountï¼šå°†å­˜å‚¨å·å–æ¶ˆæŒ‚è½½<br>å…·ä½“çš„å¯ä»¥çœ‹å®˜æ–¹è®¾è®¡æ–‡æ¡£<a href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-storage/flexvolume.md" target="_blank" rel="noopener">https://github.com/kubernetes/community/blob/master/contributors/devel/sig-storage/flexvolume.md</a></driver></p>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/post/flex-volume-plugin/#more" rel="contents">
                é˜…è¯»å…¨æ–‡ &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.spider.im/post/lvm/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lovejoy">
      <meta itemprop="description" content="ä»Šå¤©ä¸å¼€å¿ƒ">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åæ ¸|Core Dump">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/post/lvm/" class="post-title-link" itemprop="url">lvmç›¸å…³çŸ¥è¯†ä»¥åŠä¸dockeré…åˆä½¿ç”¨è®°å½•</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-12-28 14:41:48" itemprop="dateCreated datePublished" datetime="2018-12-28T14:41:48+08:00">2018-12-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-03-11 21:50:15" itemprop="dateModified" datetime="2019-03-11T21:50:15+08:00">2019-03-11</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="LVMåŸºç¡€çŸ¥è¯†"><a href="#LVMåŸºç¡€çŸ¥è¯†" class="headerlink" title="LVMåŸºç¡€çŸ¥è¯†"></a>LVMåŸºç¡€çŸ¥è¯†</h2><p>LVMç°åœ¨ç”¨çš„è¿˜æ˜¯æŒºå¤šçš„ï¼Œæ¯æ¬¡çœ‹æ¯æ¬¡æ¯æ¬¡å¿˜ï¼Œè¿˜æ˜¯è®°å½•ä¸‹å§</p>
<p>LVM3ä¸ªæ¦‚å¿µï¼ŒPVï¼ŒVGï¼ŒLV é€’è¿›å¼çš„ï¼Œä¸€å±‚å±‚å¾€ä¸Š</p>
<p><img src="https://img.linux.net.cn/data/attachment/album/201406/18/134408sa12dauefffyszfg.jpg" alt="LVM"></p>
<p>å¦‚å›¾æ‰€ç¤º:</p>
<ol>
<li>PVå¯ä»¥åˆ›å»ºåœ¨ä¸€å—ç¡¬ç›˜ pvcreate /dev/sdb æˆ–è€…ä¸€ä¸ªåˆ†åŒºä¸Š pvcreate /dev/sdb1 </li>
<li>VGåˆ›å»ºåœ¨PVä¹‹ä¸Š,VGå¯ä»¥è·¨å¤šä¸ªPVåˆ›å»º vgcreate docker /dev/sdb /dev/sdc</li>
<li>LVåˆ›å»ºåœ¨VGä¹‹ä¸­ï¼ŒLVä¸å¯ä»¥è·¨VG, lvcreate -L ${SIZE} -n ${VOLUMEID} ${VG} ,å¯ä»¥-LæŒ‡å®šå¤§å°åˆ›å»ºï¼Œä¹Ÿå¯ä»¥lvcreate â€“wipesignatures y -n thinpool docker -l 95%VG æŒ‰ç™¾åˆ†æ¯”çš„æ–¹å¼åˆ›å»º</li>
</ol>
<p>æ—¥å¸¸å‘½ä»¤ï¼š<br>pvs,vgs,lvs ä¸€ç±»å‘½ä»¤ï¼Œæˆ‘ä¸€èˆ¬ç”¨æ¥çœ‹ç©ºé—´å¤§å°ä»¥åŠè¿˜å‰©ç©ºé—´<br>vgså¯ä»¥çœ‹åˆ°å‰©ä½™çš„ç©ºé—´ï¼Œè¡¨ç¤ºlvåˆ†ä¸å‡ºå»äº†å°±å äº†é‚£ä¹ˆå¤§ï¼Œä¸èƒ½è¶…å–<br>vgdisplay docker â€“units g | grep â€˜VG Sizeâ€™ | awk â€˜{print $3}â€™ | cut -d. -f1 çœ‹dockerè¿™ä¸ªvgçš„å¤§å°</p>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/post/lvm/#more" rel="contents">
                é˜…è¯»å…¨æ–‡ &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.spider.im/post/jumpserver/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lovejoy">
      <meta itemprop="description" content="ä»Šå¤©ä¸å¼€å¿ƒ">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åæ ¸|Core Dump">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/post/jumpserver/" class="post-title-link" itemprop="url">ç®€å•é™åˆ¶ç”¨æˆ·å¯æ‰§è¡Œå‘½ä»¤æ¥åšå ¡å’æœºçš„æ–¹æ¡ˆ</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-12-27 17:52:13" itemprop="dateCreated datePublished" datetime="2018-12-27T17:52:13+08:00">2018-12-27</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-03-11 21:50:15" itemprop="dateModified" datetime="2019-03-11T21:50:15+08:00">2019-03-11</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>ä»Šå¤©æœ‰æœ‹å‹é—®æ€ä¹ˆé™åˆ¶ç”¨æˆ·èƒ½æ‰§è¡Œçš„å‘½ä»¤æ¥åšè·³æ¿æœºï¼Œçœ‹äº†ä¸‹æœ‰å¥½å‡ ç§ï¼Œè¿™é‡Œè®°å½•ä¸‹</p>
<ol>
<li>å°†/etc/passwdç›¸åº”ç”¨æˆ·çš„æœ€åä¸€åˆ—æ¢æˆè‡ªå·±çš„ä¸€ä¸ªè„šæœ¬ï¼Œè„šæœ¬é‡Œé¢é™åˆ¶ç”¨æˆ·åªèƒ½è¾“å…¥IPï¼Œç„¶åè„šæœ¬å»è‡ªåŠ¨ssh<br>å¯ä»¥useradd -s xxx usernameçš„æ–¹å¼æ¥ä¿®æ”¹ï¼Œä¸è¿‡æˆ‘ä¸€èˆ¬å–œæ¬¢ç›´æ¥vim<br>è„šæœ¬å¯ä»¥å‚è€ƒ<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> [1];<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">"Input User@IP: "</span></span><br><span class="line">  <span class="built_in">read</span> input</span><br><span class="line">  <span class="keyword">case</span> <span class="string">"<span class="variable">$input</span>"</span> <span class="keyword">in</span></span><br><span class="line">    q|quit|QUIT|Q)</span><br><span class="line">        <span class="built_in">exit</span></span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null <span class="string">"<span class="variable">$input</span>"</span></span><br><span class="line">        ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/post/jumpserver/#more" rel="contents">
                é˜…è¯»å…¨æ–‡ &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.spider.im/post/k8s-rbac/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lovejoy">
      <meta itemprop="description" content="ä»Šå¤©ä¸å¼€å¿ƒ">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åæ ¸|Core Dump">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/post/k8s-rbac/" class="post-title-link" itemprop="url">k8sä¸ŠrbacåŠŸèƒ½å®è·µ</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-12-26 14:20:34" itemprop="dateCreated datePublished" datetime="2018-12-26T14:20:34+08:00">2018-12-26</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-03-11 21:50:15" itemprop="dateModified" datetime="2019-03-11T21:50:15+08:00">2019-03-11</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>ä¸Šä¸€ç¯‡å·²ç»è®²åˆ°äº† ABACï¼Œè¿™ç¯‡è®²ä¸‹ RBACï¼ŒRBAC ç°åœ¨æ˜¯ k8s å®˜æ–¹æ¨èçš„åšæƒé™é™åˆ¶çš„æ–¹æ¡ˆï¼ŒABAC å·²ç»<a href="https://github.com/kubernetes/kubernetes/issues/72097#issuecomment-447862432" target="_blank" rel="noopener">ä¸å†åšåŠŸèƒ½å¢åŠ äº†</a></p>
<p><a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>å†™çš„æœ‰ç‚¹å¤æ‚ï¼Œè¿™é‡Œç®€åŒ–æè¿°ä¸‹ï¼ŒRBAC é¦–å…ˆæœ‰2ä¸ªæ¦‚å¿µï¼š</p>
<ul>
<li>ä¸€ä¸ªå« Roleï¼ˆæˆ–è€…æ˜¯ClusterRoleï¼‰ï¼ŒRole é‡Œé¢å®šä¹‰äº†å¯ä»¥å¹²ä»€ä¹ˆäº‹æƒ…ï¼Œæœ‰ä»€ä¹ˆæ ·çš„æƒé™ï¼ŒRole å®šä¹‰çš„èµ„æºåªèƒ½æ˜¯æŸä¸ªæ—¢å®š namespace ä¸‹çš„ï¼Œè€ŒClusterRole å¯ä»¥å®šä¹‰ cluster ç›¸å…³çš„èµ„æºï¼Œæ¯”å¦‚å¯¹namespaceè¿™ä¸ªèµ„æºæœ¬èº«çš„æƒé™ã€‚</li>
<li>å¦å¤–ä¸€ä¸ªæ¦‚å¿µå« RoleBinding(ClusterRoleBinding) æ˜¯ä¸€ä¸ªæŠŠç”¨æˆ·å’Œ ROLE å…³è”èµ·æ¥çš„ä¸œè¥¿ï¼Œå³è¿™ä¸ªç”¨æˆ·æœ‰è¿™ä¸ª Role é‡Œé¢å®šä¹‰çš„æƒé™. PSç”¨æˆ·ä¸€èˆ¬æ˜¯ â€“basic-auth-file é‡Œé¢å®šä¹‰çš„ç”¨æˆ·ï¼Œå½“ç„¶ä¹Ÿæœ‰äº›ç³»ç»Ÿé»˜è®¤æœ‰çš„è´¦æˆ·ï¼Œæ¯”å¦‚ system:unsecure è¡¨ç¤ºèµ°httpè®¿é—®æ²¡æœ‰è®¤è¯çš„ã€‚</li>
</ul>
<p>å…·ä½“çš„ä¾‹å­ï¼š<br>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/post/k8s-rbac/#more" rel="contents">
                é˜…è¯»å…¨æ–‡ &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </p></div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.spider.im/post/k8s-abac/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lovejoy">
      <meta itemprop="description" content="ä»Šå¤©ä¸å¼€å¿ƒ">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åæ ¸|Core Dump">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/post/k8s-abac/" class="post-title-link" itemprop="url">k8sä¸ŠabacåŠŸèƒ½å®è·µ</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-12-17 15:42:06" itemprop="dateCreated datePublished" datetime="2018-12-17T15:42:06+08:00">2018-12-17</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-03-11 21:50:15" itemprop="dateModified" datetime="2019-03-11T21:50:15+08:00">2019-03-11</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>k8sæä¾›äº†2ç§æ–¹å¼ç”¨æ¥æƒé™æ§åˆ¶ï¼Œabacå’Œrbacï¼Œabacæ˜¯åŸºäºä¸€å †å±æ€§(attribute)æè¿°æˆçš„ç­–ç•¥(policy)æ¥åšçš„é™åˆ¶ã€‚<br>æ¯”å¦‚é™åˆ¶æŸä¸ªç”¨æˆ·åªèƒ½å¯¹æŸä¸ªnamespaceä¸‹çš„èµ„æºæ“ä½œï¼Œå°±å¯ä»¥å†™æˆç±»ä¼¼ä¸‹é¢çš„æè¿°<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"apiVersion"</span>: <span class="string">"abac.authorization.kubernetes.io/v1beta1"</span>, <span class="attr">"kind"</span>: <span class="string">"Policy"</span>, <span class="attr">"spec"</span>: &#123;<span class="attr">"user"</span>: <span class="string">"alice"</span>, <span class="attr">"namespace"</span>: <span class="string">"somenamespace"</span>, <span class="attr">"resource"</span>: <span class="string">"*"</span>, <span class="attr">"apiGroup"</span>: <span class="string">"*"</span>&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹åˆ°å…¶å®å°±æ˜¯user namespace resource apiGroup ç­‰å‡ ä¸ªé€‰é¡¹çš„æ’åˆ—ç»„åˆ</p>
<p>è¦å¯ç”¨ABACéœ€è¦ä¿®æ”¹apiserverçš„å¯åŠ¨å‚æ•° åŠ ä¸Šâ€“authorization-mode=ABAC å’Œ â€“authorization-policy-file=SOME_FILENAMEï¼Œè¿™é‡Œçš„SOME_FILENAME å°±æ˜¯ä¸ªå¡«å†™äº†ç±»ä¼¼ä»¥ä¸Šjsonçš„æ–‡ä»¶ï¼Œå¯ä»¥å¡«å¤šè¡Œï¼Œæ¥åšå¤šä¸ªç»„åˆé™åˆ¶ï¼Œ<a href="https://github.com/kubernetes/kubernetes/blob/master/pkg/auth/authorizer/abac/example_policy_file.jsonl" target="_blank" rel="noopener">ç‚¹è¿™é‡Œçœ‹ä¸€ä¸ªå…·ä½“çš„æ–‡ä»¶åˆ—å­</a><br>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/post/k8s-abac/#more" rel="contents">
                é˜…è¯»å…¨æ–‡ &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </p></div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.spider.im/post/service-account-issue/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lovejoy">
      <meta itemprop="description" content="ä»Šå¤©ä¸å¼€å¿ƒ">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åæ ¸|Core Dump">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/post/service-account-issue/" class="post-title-link" itemprop="url">service-account-issue</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-10-08 11:07:01" itemprop="dateCreated datePublished" datetime="2018-10-08T11:07:01+08:00">2018-10-08</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-03-11 21:50:15" itemprop="dateModified" datetime="2019-03-11T21:50:15+08:00">2019-03-11</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>åœ¨é…åˆä½¿ç”¨é«˜ç‰ˆæœ¬k8så’Œä½ç‰ˆæœ¬k8sçš„æ—¶å€™é‡åˆ°äº†serviceAccountæŠ¥é”™çš„é—®é¢˜ <code>No API token found for service account &quot;default&quot;, retry after the token is automatically created and added to the service account</code></p>
<p>å¤§æ¦‚çœ‹äº†çœ¼ä»£ç ï¼Œk8sçš„apiserveråœ¨åˆ›å»ºpodçš„æ—¶å€™ä¼šçœ‹è¿™ä¸ªpodæœ‰æ²¡æœ‰è‡ªå·±æŒ‡å®šserviceaccountè¿™ä¸ªé¡¹ç›®ï¼Œå¦‚æœæ²¡æœ‰çš„è¯å°±ç”¨é»˜è®¤çš„default serviceaccount ï¼Œç„¶åmountåˆ°podçš„/var/run/secrets/kubernetes.io/serviceaccount </p>
<p>å…¶ä¸­æœ‰ä¸ªæ­¥éª¤æ˜¯å»æ‰¾è¿™ä¸ªserviceAccountçš„secretä¿¡æ¯ï¼Œä½†æ˜¯å¾ˆä¸å¹¸çš„æ˜¯æˆ‘ç”¨çš„æ˜¯é«˜ç‰ˆæœ¬çš„apiserverå’Œä½ç‰ˆæœ¬çš„controllerï¼Œæ²¡æœ‰è‡ªåŠ¨åˆ›å»ºè¿™ä¸ªå‡ºæ¥ã€‚è€Œä¸”å…¶å®æˆ‘ä¹Ÿç”¨ä¸åˆ°è¿™ä¸ªåŠŸèƒ½<br>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/post/service-account-issue/#more" rel="contents">
                é˜…è¯»å…¨æ–‡ &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </p></div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="ä¸Šä¸€é¡µ"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="ä¸‹ä¸€é¡µ"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">lovejoy</p>
              <p class="site-description motion-element" itemprop="description">ä»Šå¤©ä¸å¼€å¿ƒ</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">54</span>
                    <span class="site-state-item-name">æ—¥å¿—</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">12</span>
                    <span class="site-state-item-name">åˆ†ç±»</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">13</span>
                    <span class="site-state-item-name">æ ‡ç­¾</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/lovejoy" title="Github &rarr; https://github.com/lovejoy" rel="noopener" target="_blank"><i class="fa fa-fw fa-globe"></i>Github</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://twitter.com/liangyongqing" title="Twitter &rarr; https://twitter.com/liangyongqing" rel="noopener" target="_blank"><i class="fa fa-fw fa-globe"></i>Twitter</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lovejoy</span>

  

  
</div>


  <div class="powered-by">ç”± <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> å¼ºåŠ›é©±åŠ¨ v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ â€“ <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.0.1</div>




        




  <script>
    (function() {
      var hm = document.createElement("script");
      hm.src = "//tajs.qq.com/stats?sId=63414042";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>





        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.1"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.1"></script>



  

  


  <script src="/js/src/bootstrap.js?v=7.0.1"></script>


  
  



  




  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
